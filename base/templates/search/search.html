{% extends '_layouts/base.html' %}

<!-- Metadata -->
{% block page_title %}Search{% endblock %}
<!-- End Metadata -->

{% block content %}

    <form method="get" action=".">

        <!-- Advanced Search Box -->
        <div class="banner">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        <h2 class="text-center">Advanced Search</h2>
                        <hr class="intro-divider">
                        <div class="form-group">
                            <div class="col-sm-4 col-sm-offset-1 adv-form">
                                {{ form.property }}
                            </div>
                            <div class="col-sm-3 adv-form">
                                {{ form.search_type }}
                            </div>
                            <div class="col-sm-4 adv-form">
                                {{ form.q }}
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-1 adv-form">
                                {{ form.op }}
                            </div>
                            <div class="col-sm-4 adv-form">
                                {{ form.property2 }}
                            </div>
                            <div class="col-sm-3 adv-form">
                                {{ form.search_type2 }}
                            </div>
                            <div class="col-sm-4 adv-form">
                                {{ form.q2 }}
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-1 adv-form">
                                {{ form.op2 }}
                            </div>
                            <div class="col-sm-4 adv-form">
                                {{ form.property3 }}
                            </div>
                            <div class="col-sm-3 adv-form">
                                {{ form.search_type3 }}
                            </div>
                            <div class="col-sm-4 adv-form">
                                {{ form.q3 }}
                            </div>
                        </div>
                        <div class="model_selector">
                            <div class="col-sm-2 col-sm-offset-2">
                                <p>Limit Search To: </p>
                            </div>
                            <div class="col-sm-8">                   
                                {{ form.models }}
                            </div>
                        </div>
                        <ul class="list-inline center-block text-center adv-form">
                            <li>
                                Order By:{{ form.order }}
                            </li>
                            <li>
                                <p>
                                    <input type="submit" value="Search">
                                </p>
                            </li>
                            <li>
                                <p>
                                    <input onClick="clear_pub_search()" type="button" value="Clear" />
                                </p>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Advanced Search Box -->

        {% if query or page.object_list %}
            <div class="content-section-b">
                <div class="container">
                    <div class="row">
          
                        <!-- Facets Column -->
                        <div class="col-md-4">
                            <div class="well">
                                <!-- Begin faceting -->
                                <div id="ot_facetname">
                                    <h4>By Object Type</h4>
                                </div>
                                <dl id="ot_facetvalues">
                                    {% if facets.fields.facet_prop_19 %}
                                        {% for prop in facets.fields.facet_prop_19 %}
                                            {% if prop.1 > 0 %}
                                                <dd><a href="{{ request.get_full_path }}&amp;selected_facets=facet_prop_19:{{ prop.0|urlencode }}">{{ prop.0 }}</a> ({{ prop.1 }})</dd>
                                            {% endif %}
                                        {% endfor %}
                                    {% else %}
                                        <p>No object type facets.</p>
                                    {% endif %}
                                </dl>
                                <div id="ot_slidermenu"></div>
                            </div>  
                        </div>
                        <!-- End Facets Column -->
        
                        <!-- Results Column -->
                        <div class="col-md-8">
                            <h2 style="text-align:center">Results</h2>
                            <button class="btn btn-default" style="float: right;"><a href="{% url 'export_search_results' %}?p1={{ request.GET.property }}&st1={{ request.GET.search_type }}&q1={{ request.GET.q }}&op1={{ request.GET.op }}&p2={{ request.GET.property2 }}&st2={{ request.GET.search_type2 }}&q2={{ request.GET.q2 }}&op2={{ request.GET.op2 }}&p3={{ request.GET.property3 }}&st3={{ request.GET.search_type3 }}&q3={{ request.GET.q3 }}&order={{ request.GET.order }}">Export</a></button>
                            <button id="collapse-init" class="btn btn-default" style="float: right;">Expand All</button></br>
                            
                            <!-- Result Count -->
                            <p>{{ page.paginator.count }} results</p>
              
                            {% for result in page.object_list %}
                                {% include 'search/_result_object.html' %}
                            {% empty %}
                                <p>No results found.</p>
                            {% endfor %}

                            {% if page.has_previous or page.has_next %}
                                <div>
                                    {% if page.has_previous %}
                                        <a href="?{{ request.GET.urlencode }}&amp;page={{ page.previous_page_number }}">
                                    {% endif %}
                                    &laquo; Previous
                                    {% if page.has_previous %}
                                        </a>
                                    {% endif %}
                                    |
                                    {% if page.has_next %}
                                        <a href="?{{ request.GET.urlencode }}&amp;page={{ page.next_page_number }}">
                                    {% endif %}
                                    Next &raquo;
                                    {% if page.has_next %}
                                        </a>
                                    {% endif %}
                                </div>
                            {% endif %}
                        </div>
                        <!-- End Results Column -->
      
                    </div>
                </div>
            </div>

        {% else %}
            {# Show some example queries to run, maybe query syntax, something else? #}
        {% endif %}
    </form>
{% endblock %}

<!-- Search Unique JS -->
{% block js %}

{{ block.super }}

  <script>
    $(document).ready(function () {

        var active = true;

        $('#collapse-init').click(function (event) {
            event.preventDefault();
            if (active) {
                active = false;
                $('.panel-collapse').collapse('show');
                $('.panel-title').attr('data-toggle', '');
                $(this).text('Collapse All');
            } else {
                active = true;
                $('.panel-collapse').collapse('hide');
                $('.panel-title').attr('data-toggle', 'collapse');
                $(this).text('Expand All');
            }
        });
        
        $('#accordion').on('show.bs.collapse', function () {
            if (active) $('#accordion .in').collapse('hide');
        });

    });
  </script>
  
  <script>
    (function($) {
      jQuery(document).ready(function() {
        var ListLengthHidingTrigger = 7;
        var InitialListItems = 6;

        if ($("#ot_facetvalues dd").length > ListLengthHidingTrigger) {
            $("#ot_facetvalues dd:gt("+(InitialListItems-1)+")").hide(); // hide all but first N sections
            $('#ot_slidermenu').html('Show All Object Types');
        }
        $('div#ot_slidermenu:contains("All")').live('click',function() {
                        $('#ot_facetvalues dd').show(); // hide all but first 2 sections
                        $('#ot_slidermenu').html('Show Fewer Object Types');            
        });
        $('div#ot_slidermenu:contains("Fewer")').live('click',function() {
                        $("#ot_facetvalues dd:gt("+(InitialListItems-1)+")").hide(); // hide all but first N sections
                        $('#ot_slidermenu').html('Show All Object Types');            
        });
        $('#ot_facetname').click(function() {
            $('#ot_facetvalues').slideToggle(0);
        });        
      })
    });
  </script>   

{% endblock %}
<!-- End Search Unique JS -->